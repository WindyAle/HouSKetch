# client.py

from model import ModelManager

# --- 1. ë™ì  ì˜ë¢°ì„œ ìƒì„± ---

def generate_request(model_manager: ModelManager) -> str:
    """
    ModelManagerì˜ ì±„íŒ… ëª¨ë¸ì„ ì‚¬ìš©í•´
    ë…íŠ¹í•˜ê³  ì°½ì˜ì ì¸ ê³ ê° ì˜ë¢°ì„œë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
    """
    print("ê³ ê° ìš”êµ¬ì‚¬í•­ ìƒì„± ì¤‘...\n")
    
    # AIì—ê²Œ 'ê³ ê°' ì—­í• ì„ ë¶€ì—¬í•˜ëŠ” ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
    system_prompt = (
        "ë‹¹ì‹ ì€ ì¸í…Œë¦¬ì–´ ë””ìì´ë„ˆë¥¼ ê³ ìš©í•˜ê³  ì‹¶ì–´í•˜ëŠ” ê³ ê°ì…ë‹ˆë‹¤. "
        "ë‹¹ì‹ ì´ ì›í•˜ëŠ” ë°©ì˜ ë””ìì¸ì„ 1-2 ë¬¸ì¥ìœ¼ë¡œ ì„¤ëª…í•˜ì„¸ìš”. "
        "êµ¬ì²´ì ì´ê³  ë…íŠ¹í•œ ìš”êµ¬ì‚¬í•­ì„ ëª…í™•í•˜ê²Œ ë§í•˜ì„¸ìš”. (ì˜ˆ: 'ë¯¸ë‹ˆë©€ë¦¬ìŠ¤íŠ¸', 'ì•„ëŠ‘í•œ', 'ê³ ê¸‰ìŠ¤ëŸ¬ìš´', 'ëª¨ë˜í•œ', 'í™”ë ¤í•œ') "
        "ë°©ì— ê¼­ ìˆì–´ì•¼ í•˜ëŠ” 2-3ê°œì˜ í•„ìˆ˜ ê°€êµ¬ í˜¹ì€ ìƒ‰ê¹”ë„ ë§í•˜ì„¸ìš”. "
        "í•œêµ­ì–´ë¡œ ë§í•˜ì„¸ìš”."
    )
    
    # ê°„ë‹¨í•œ ì‚¬ìš©ì í”„ë¡¬í”„íŠ¸
    user_prompt = "ì €ë§Œì„ ìœ„í•œ ìƒˆë¡­ê³  ë…íŠ¹í•œ ì§‘ì„ ë§Œë“¤ì–´ì£¼ì„¸ìš”."
    
    # --- í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ì£¼ì„
    # try:
    #     request_text = model_manager.get_chat_response(system_prompt, user_prompt)
    #     # LLMì´ ìƒì„±í•œ í…ìŠ¤íŠ¸ì— í¬í•¨ë  ìˆ˜ ìˆëŠ” ë”°ì˜´í‘œ ì œê±°
    #     request_text = request_text.strip().replace('"', '')
        
    #     print(f"New Request: {request_text}")
    #     return request_text
    # except Exception as e:
    #     print(f"Error generating request: {e}")
    #     return "Default Request: A simple room with a bed and a table."
    request_text = "ì €ëŠ” ì•„ëŠ‘í•œ ìŠ¤íƒ€ì¼ì˜ ê±°ì‹¤ì„ ì›í•´ìš”. ë°˜ë“œì‹œ ì†ŒíŒŒ 1ê°œì™€ í…Œì´ë¸” 1ê°œê°€ ìˆì–´ì•¼ í•©ë‹ˆë‹¤."
    
    return request_text

# --- 2. ìƒì„¸ í”¼ë“œë°± ìƒì„± ---

def generate_feedback(model_manager: ModelManager, request: str, design_description: str, score: float) -> str:
    """
    ModelManagerì˜ ì±„íŒ… ëª¨ë¸ì„ ì‚¬ìš©í•´
    ì ìˆ˜ì— ê¸°ë°˜í•œ ìƒì„¸í•œ ê³ ê° í”¼ë“œë°±ì„ ìƒì„±í•©ë‹ˆë‹¤.
    """
    print("ğŸ“„ ê³ ê° í”¼ë“œë°± ìƒì„± ì¤‘...")
    
    # AIì—ê²Œ 'í‰ê°€ì' ì—­í• ì„ ë¶€ì—¬í•˜ëŠ” ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
    system_prompt = (
        "ë‹¹ì‹ ì€ ë””ìì´ë„ˆì˜ ì‘í’ˆì„ í‰ê°€í•˜ëŠ” ê³ ê°ì…ë‹ˆë‹¤. "
        "ë‹¹ì‹ ì´ ì œê³µí•œ ìš”êµ¬ì‚¬í•­ê³¼ í•¨ê»˜ ê·¸ì— ë”°ë¼ ë””ìì´ë„ˆê°€ ì‘ì—…í•œ ê²°ê³¼ë¬¼ì„ ë°›ì•˜ìŠµë‹ˆë‹¤. "
        "ë‹¹ì‹ ì€ 0-5ì ì˜ ë²”ìœ„ì—ì„œ í‰ì ì„ ì£¼ì—ˆìŠµë‹ˆë‹¤. "
        "ë‹¹ì‹ ì´ 'ì™œ' í‰ì ì„ ê·¸ë ‡ê²Œ ì£¼ì—ˆëŠ”ì§€ ëª…í™•í•œ ë°©ë²•ìœ¼ë¡œ 1-2ê°œì˜ ë¬¸ì¥ìœ¼ë¡œ ë””ìì´ë„ˆì—ê²Œ ì„¤ëª…í•´ì•¼ í•©ë‹ˆë‹¤. "
        "í‰ì ì´ ë†’ë‹¤ë©´ ë””ìì´ë„ˆë¥¼ ê²©ë ¤í•˜ë©° ì¹­ì°¬í•˜ê³ , í‰ì ì´ ë‚®ë‹¤ë©´ ë¹„íŒì ì´ë©° ì§ì„¤ì ìœ¼ë¡œ ë§í•˜ì„¸ìš”. "
        "í•œêµ­ì–´ë¡œ ë§í•˜ì„¸ìš”."
    )
    
    # LLMì—ê²Œ ëª¨ë“  ì»¨í…ìŠ¤íŠ¸ë¥¼ ì œê³µí•˜ëŠ” ì‚¬ìš©ì í”„ë¡¬í”„íŠ¸
    user_prompt = (
        f"ë‚˜ì˜ ì›ë˜ ìš”êµ¬ì‚¬í•­: \"{request}\"\n"
        f"ë””ìì´ë„ˆì˜ ê²°ê³¼ë¬¼: \"{design_description}\"\n"
        f"ë‚´ í‰ì : {score:.1f} / 5.0\n\n"
        "ì´ê²ƒì„ ì°¸ê³ í•˜ì—¬ ê³ ê°ìœ¼ë¡œì„œ ë””ìì´ë„ˆì—ê²Œ í”¼ë“œë°±ì„ ì‘ì„±í•˜ì„¸ìš”."
    )
    
    # --- í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ì£¼ì„ ---
    # try:
    #     feedback_text = model_manager.get_chat_response(system_prompt, user_prompt)
    #     feedback_text = feedback_text.strip().replace('"', '')
        
    #     print("[ í”¼ë“œë°± ]")
    #     print(feedback_text)
    #     return feedback_text
    # except Exception as e:
    #     print(f"Error 'generate_feedback()': {e}")
    #     return "No comment"

    if score >= 4.0:
        feedback_text = f"ì™€, {score:.1f}ì ì…ë‹ˆë‹¤! ì œê°€ ì›í•˜ë˜ ë°”ë¡œ ê·¸ ëŠë‚Œì´ì—ìš”. ì™„ë²½í•©ë‹ˆë‹¤!"
    elif score >= 2.0:
        feedback_text = f"{score:.1f}ì ì´ë„¤ìš”. ìŒ, ë‚˜ì˜ì§„ ì•Šì§€ë§Œ... ì œê°€ ì›í•œ ê²ƒê³¼ëŠ” ì¡°ê¸ˆ ë‹¤ë¥´ë„¤ìš”."
    else:
        feedback_text = f"{score:.1f}ì ì´ë¼ë‹ˆ... ì´ê±´ ì™„ì „íˆ ì˜ëª»ëì–´ìš”. ë‹¤ì‹œ í•´ì£¼ì„¸ìš”."
        
    print("[ í”¼ë“œë°± ]")
    print(feedback_text)
    return feedback_text